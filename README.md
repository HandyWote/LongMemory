# AI长记忆系统设计

## 概述

本项目旨在解决AI系统中长期记忆管理的核心难题——记忆浓缩问题。传统方法直接将原始信息传递给大语言模型，这种方式存在明显缺陷：

- 大量占用上下文窗口资源
- 容易造成提示词污染
- 无法模拟人类记忆的选择性特征

人类记忆具有显著的选择性：近期对话内容能够清晰记住，但随着时间推移，具体细节会逐渐模糊，只保留大致印象。只有在情绪强烈的场景中，才会保留较多细节。本系统正是基于这一认知机制设计，实现了更自然、高效的记忆管理。

## 系统架构

本系统采用分层记忆架构，模拟人类记忆机制，包含以下三个核心层次：

### 1. 短时记忆层
- 采用传统记忆模式
- 查询数据库，提取最近N条消息直接传递给大语言模型
- 保证近期对话的准确性和连贯性

### 2. 长记忆层
- 构建模糊的用户画像
- 设计遗忘系统，对陈旧记忆进行浓缩存储
- 类似于人对另一个人的整体印象
- 每次生成新印象时参考历史印象，调用时仅使用最新印象

### 3. 学习层
- 自主构建知识图谱
- 接收原始数据并通过HTTP接口存储在数据库中
- 从对话中提取实体、关系及原文摘要构建知识图谱
- 知识库中的知识不会遗忘，类似人类学习到的知识

### 使用机制
系统将用户画像、知识层、短时记忆和当前需求一并放入上下文窗口，协同生成回复。

## 技术实现

### 数据接入
设计HTTP请求仓库或原始信息接口接收数据，确保系统能够灵活接入各种数据源。

### 数据存储
使用高性能数据库存储原始信息，保证数据的安全性和访问效率。

### 知识处理
从对话中提取实体和关系，构建包含实体概念、实体关系和原文摘要的知识图谱，形成结构化的知识表示。

### 记忆管理
通过遗忘系统处理时间陈旧的记忆，进行智能记忆浓缩，确保系统不会因信息过载而降低性能。

## 核心优势

- **仿生记忆机制**：模拟人类记忆的选择性特征，实现更自然的记忆管理
- **分层架构设计**：兼顾短期对话的准确性和长期记忆的有效性
- **知识持久化**：通过知识图谱确保重要知识不会遗忘
- **智能遗忘系统**：避免信息过载，提高系统运行效率

## 系统流程

以下流程图展示了系统的整体工作流程：

```mermaid
flowchart TD
    A[用户输入] --> B{数据接收层}
    B --> C[HTTP请求仓库]
    B --> D[原始信息接口]
    C --> E[数据库存储]
    D --> E[数据库存储]
    
    E --> F{记忆处理层}
    F --> G[短时记忆模块]
    F --> H[长记忆模块]
    F --> I[学习模块]
    
    G --> J[近期N条消息提取]
    J --> K[直接传给大模型]
    
    H --> L[遗忘系统]
    L --> M[时间陈旧记忆识别]
    M --> N[记忆浓缩算法]
    N --> O[用户画像构建]
    O --> P[印象更新机制]
    
    I --> Q[实体识别]
    I --> R[关系抽取]
    I --> S[原文摘要生成]
    Q --> T[知识图谱构建]
    R --> T[知识图谱构建]
    S --> T[知识图谱构建]
    T --> U[永久知识库存储]
    
    K --> V[大模型处理]
    P --> V[大模型处理]
    U --> V[大模型处理]
    
    V --> W[生成响应]
    W --> X[返回给用户]
    
    subgraph 短时记忆层
        G
        J
        K
    end
    
    subgraph 长记忆层
        H
        L
        M
        N
        O
        P
    end
    
    subgraph 学习层
        I
        Q
        R
        S
        T
        U
    end
    
    style G fill:#e1f5fe
    style H fill:#f3e5f5
    style I fill:#e8f5e8